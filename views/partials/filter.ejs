<!-- <link rel="stylesheet" href="/css/filterPage.css" /> -->
<%
  const safeCurrentCategory = (typeof currentCategory !== 'undefined') ? currentCategory : [];
  const safeSelectedSort = (typeof selectedSort !== 'undefined') ? selectedSort : "";
  const safeAllCountries = (typeof allCountries !== 'undefined') ? allCountries : [];
  const safeSelectedCountries = (typeof selectedCountries !== 'undefined') ? selectedCountries : [];
%>

<form action="/listings" method="GET">

  <input type="hidden" name="category" value="<%= safeCurrentCategory %>">

  <div class="accordion" id="filterAccordion">
    <br><br>
    <!-- SORT -->
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingSort">
        <button class="accordion-button" type="button" data-bs-toggle="collapse"
          data-bs-target="#collapseSort">
          <strong>Sort By</strong>
        </button>
      </h2>
      <div id="collapseSort" class="accordion-collapse collapse show">
        <div class="accordion-body">
          <label for="sort" class="form-label">Sort options:</label>
          <select id="sort" name="sort" class="form-select">
            <option value="" <%= safeSelectedSort === '' ? 'selected' : '' %>>Default</option>
            <option value="price_asc" <%= safeSelectedSort === 'price_asc' ? 'selected' : '' %>>
              Price: Low to High
            </option>
            <option value="price_desc" <%= safeSelectedSort === 'price_desc' ? 'selected' : '' %>>
              Price: High to Low
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- CATEGORY FILTER -->
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingCatFilter">
        <button class="accordion-button collapsed" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseCatFilter">
          <strong>Filter by Category</strong>
        </button>
      </h2>

      <div id="collapseCatFilter" class="accordion-collapse collapse">
        <div class="accordion-body">

          <div class="form-control" style="max-height: 250px; overflow-y: auto;">

            <%
              const allCategories = [
                "Trending","Rooms","Mountains","Iconic Cities","Castles","Pools",
                "Camping","Farms","Arctic","Boats","Domes","Beaches",
                "Luxury","Wildlife","Adventure"
              ];

              const selectedCategories = Array.isArray(safeCurrentCategory)
                ? safeCurrentCategory
                : (safeCurrentCategory ? [safeCurrentCategory] : []);
            %>

            <% allCategories.forEach(cat => { %>
              <div class="form-check">
                <input class="form-check-input" type="checkbox"
                  name="category" value="<%= cat %>"
                  <%= selectedCategories.includes(cat) ? "checked" : "" %> >
                <label class="form-check-label"><%= cat %></label>
              </div>
            <% }); %>

          </div>
        </div>
      </div>
    </div>

    <!-- COUNTRY FILTER -->
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingCountry">
        <button class="accordion-button collapsed" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseCountry">
          <strong>Filter by Country</strong>
        </button>
      </h2>
      <div id="collapseCountry" class="accordion-collapse collapse">
        <div class="accordion-body">
          <div class="form-control" style="max-height: 250px; overflow-y: auto;">
            <% safeAllCountries.forEach(country => { %>
              <div class="form-check">
                <input type="checkbox" class="form-check-input"
                  name="country" value="<%= country %>"
                  <%= safeSelectedCountries.includes(country) ? 'checked' : '' %>>
                <label class="form-check-label"><%= country %></label>
              </div>
            <% }); %>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="mt-3">
    <button type="submit" class="btn btn-primary w-100 mb-2">Apply Filters</button>
    <a href="/listings" class="btn btn-outline-secondary w-100">Clear Filters</a>
  </div>

</form>
